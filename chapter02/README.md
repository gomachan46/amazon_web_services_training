# 仮想サーバの作成(EC2基本編)

## 2.1 AmazonEC2の概要

### EC2

仮想サーバを必要なときに必要なだけ調達でき、使った分だけ料金を支払えばよいサービス

スケールアップ、スケールアウトを柔軟に変えていける

### インスタンスタイプ

サーバスペックを定義するもの。

サーバの利用料金はインスタンスタイプごとの時間単価x利用時間となる。

#### T2インスタンス

T2インスタンスはバーストする機能を持っている。


### AMI(Amazon Machine Image)

仮想サーバの起動に必要な情報が入っている

稼働当初からあるインスタンスストアと、後発のEBSがある。

現在はEBSが主流

#### AMIの仮想化形式

* 準仮想化(PV)
  * 開始当初からある
* ハードウェア仮想マシン(HVM)
  * 2013年~。現在の主流
  
今はHVMをAWSも使うことを推奨している

### EC2のストレージ

#### EBS(Elastic Block Store)

ボリュームという単位で表現されるストレージ。EBSボリュームと呼ばれる。

|タイプ|ハードウェア|容量|IOPSのパフォーマンス|用途|
|General Purpose(GP2)|SSD|1GB~16TB|1GBごとに3IOPS得られる|ルートボリュームや中小規模のDB|
|プロビジョンドIOPS|10GB~16TB|IOPSは作成時に指定。IOPSと容量には30:1の制約がある|高負荷なDB|
|Magnetic|磁気ディスク|1GB~1TB|平均100IOPS、最大数百IOPSまでバースト|読書速度やアクセス頻度が低い場合|

#### インスタンスストア

他のインスタンスへ付け替え不可能な、インスタンスを起動している間のみ利用できるストア

用途としてはtmpディレクトリの感覚

ただ、直接インスタンスにつながっているためEBSよりも高いパフォーマンスが期待できる

|ストレージタイプ|永続性|耐久性|パフォーマンス|用途|費用|
|EBS|高い|99.5~99.999%|ランダムアクセスに強い|OSやDBなどの永続性、耐久性が必要なストレージ|有料|
|インスタンスストア|低い|EBSより低い|シーケンシャルアクセスに強い|失われても問題がないストレージ|無料|

### EC2の起動

EC2の起動に必要なのは以下2点

* キーペアの作成
* セキュリティグループの作成

#### キーペアの作成

インスタンスへの接続に使用。

Linuxインスタンスの場合はSSH接続の公開鍵認証、Windowsインスタンスの場合はリモートデスクトップ接続での管理者パスワード取得用に使用する。

(Windowsインスタンスなんてあるのか)

* サービス: EC2
* メニュー: キーペア
* 概要: `キーペアの作成` ボタンから作成

秘密鍵のダウンロードが行われ、公開鍵はAWSの方で保管してもらえる。

#### セキュリティグループの作成

セキュリティグループは、EC2の外側にあるファイアウォールのようなもの。

通信の入出力制御を行うために用意されている。

基本的にサーバへ入ってくる通信(インバウンド)は全て閉じられていて、必要なものだけ開けていく。

逆にサーバから出て行く通信(アウトバウンド)のポートは全て開いている。

* サービス: EC2
* メニュー: セキュリティグループ
* 概要: `セキュリティグループの作成` ボタンから作成

セキュリティグループ名や説明を記入した後、インバウンド/アウトバウンドの設定を行える。

SSHやHTTP、Railsなどのアプリケーションサーバ用のポートを開けたり許可IPを設定したりが簡単にできる。

簡単！

リソースの整理用にタグづけとかも出来るっぽい。まぁこの辺りは管理するサーバーがたくさんあったらかなぁ〜

#### EC2の起動

EC2を起動する準備が整ったらしいので、実際に起動する。

* AMIの選択
* インスタンスタイプの選択
* インスタンスの詳細設定
* ストレージの追加
* インスタンスのタグ付け
* セキュリティグループの設定
* インスタンス作成の確認
* 既存キーペアの選択/新規作成
* Elastic IP Address(EIP)の取得
* インスタンスへのEIP付与

以上の設定をやっていって、EC2の起動をしていく。